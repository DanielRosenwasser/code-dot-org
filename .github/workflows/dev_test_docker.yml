name: test docker file
on:
  workflow_dispatch:
jobs:
  run-tests:  
    runs-on: ubuntu-latest 
    env:        
      CI: true
      RAILS_ENV: test
      RACK_ENV: test
      DISABLE_SPRING: 1
      AWS_ACCESS_KEY_ID: $${{ secrets.CI_AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: $${{ secrets.CI_AWS_SECRET_ACCESS_KEY }}    
    steps:    
      - name: Get actions code
        uses: actions/checkout@v3    
      - name: say-hello
        uses: ./.github/actions/start-server-job-actions  
#      - name: run docker
#        run: docker build -t local < ./code-dot-org/docker/dockerfiles/Dockerfile
      - name: install docker
        run: |
          brew install docker-compose
          export FIXUID=$(id -u)   
          export FIXGID=$(id -g)
          docker-compose -f ./docker/setup-compose.yml up > output.txt
        continue-on-error: true
      - name: Setup tmate session
        uses: mxschmitt/action-tmate@v3   
